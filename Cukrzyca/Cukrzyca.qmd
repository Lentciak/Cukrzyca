---
title: "Cukrzyca"
author: "Szymon Olędzki, Igor Nowiński"
language: 'polski.yml'
format: 
  html:
    code-fold: true
    code-tools: true
    code-summary: "Pokaż kod"
    code-overflow: wrap
    smooth-scroll: true
    highlight-style: dracula
    code-block-bg: true
    code-block-border-left: "#31BAE9"
    toc: true
    toc-title: "Spis treści"
theme:
  light: lightly
  dark: darkly
editor: visual
echo: true
warning: false
self-contained: true
editor_options: 
  chunk_output_type: console
---

## Czym jest cukrzyca?

**Cukrzyca** to cywilizacyjna choroba metaboliczna, charakteryzująca się podwyższonym stężeniem cukru we krwi. Cukrzyca związana jest z nieprawidłowym wydzielaniem i/lub działaniem insuliny w organizmie.

Rodzaje cukrzycy: 

-   Cukrzyca typu 1 -- charakteryzuje się niedoborem insuliny. Diabetyk wymaga leczenia insuliną. 

-   Cukrzyca typu 2 -- typowe dla niej jest zaburzone działanie i/lub wydzielanie insuliny. Osoba chora musi stosować odpowiednią dietę i przyjmować lekarstwa 

-   Cukrzyca ciążowa -- może wystąpić u kobiet w ciąży. Po urodzenia dziecka podwyższony poziom glukozy wraca do normy.

## Opis zmiennych

**Diabetes_binary** - zmienna jakościowa, przyjmuje wartości 0 - brak cukrzycy, 1 - chory na cukrzycę

**HighBP** - zmienna jakościowa, przyjmuje wartości 0 lub 1 oznaczające czy u danego pacjenta stwierdzono podwyższone ciśnienie krwi

**HighChol** - zmienna jakościowa, przyjmuje wartości 0 - u pacjenta nie stwierdzono wysokiego poziomu cholesterolu, 1 - u pacjenta stwierdzono wysoki poziom cholesterolu

**CholCheck** - zmienna jakościowa, przyjmuje wartości 0 - w ciągu ostatnich 5 lat pacjent nie sprawdzał poziomu cholesterolu, 1 - w ciągu ostatnich 5 lat pacjent sprawdzał poziom cholesterolu

**BMI** - zmienna ilościowa, wskaźnik masy ciała

**Smoker** - zmienna jakościowa, przyjmuje wartości 0 - pacjent nie palący, 1 - pacjent jest palący (w rozumieniu, czy na przestrzeni życia wypalił przynajmniej 100 papierosów, ok. 5 paczek)

**Stroke** - zmienna jakościowa, przyjmuje wartości 0 - pacjent nie doświadczył udaru mózgu, 1 - pacjent doświadczył udaru mózgu

**HeartDiseaseorAttack** - zmienna jakościowa, przyjmuje wartości 0 albo 1 w zależności od tego, czy pacjent przebył w przeszłości zawał serca/choruje na niedokrwienność serca, czy jest zdrowy.

**PhysActivity** - zmienna jakościowa, przyjmuje wartości 0 - pacjent nie posiada aktywności fizycznej z ostatnich 30 dni, 1 - pacjent

**Fruits** - zmienna jakościowa, przyjmuje wartości 0 - pacjent nie spożywa 1 lub więcej owoców w ciągu dnia, 1 - pacjent spożywa 1 lub więcej owoców w ciągu dnia

**Veggies** - zmienna jakościowa, przyjmuje wartości 0 - pacjent nie spożywa 1 lub więcej warzyw w ciągu dnia, 1 - pacjent spożywa 1 lub więcej warzyw w ciągu dnia

**HvyAlcoholConsump** - zmienna jakościowa, przyjmuje wartości 0 lub 1, w zależności od tego czy pacjent w ciągu tygodnia wypija 14 lub więcej (w przypadku mężczyzn) albo 7 lub więcej (w przypadku kobiet) napojów alkoholowych.

**AnyHealthcare** - zmienna jakościowa, przyjmuje wartości 0 lub 1, w zależności od tego czy pacjent posiada jakiegoś typu ubezpieczenie zdrowotne.

**NoDocbcCost** - zmienna jakościowa, przyjmuje wartości 0 lub 1, jeżeli w ciągu ostatnich 12 miesięcy pacjent zrezygnował z wizyty u lekarza ze względu na jej wysoką cenę 

**GenHlth** - zmienna jakościowa odpowiadająca na pytanie o ogólny (subiektywny) stan zdrowia pacjenta, przyjmuje wartości całkowite od 1 (doskonały) do 5 (słaby)

**MentHlth** - zmienna ilościowa, wartościami są odpowiedzi na pytanie o zdrowie psychiczne pacjenta - przez ile dni w ciągu ostatnich 30 dni pacjent nie czuj się dobrze pod względem psychicznym (podwyższony stres, stany depresyjne/depresja, problemy związane z emocjami) 

**PhysHlth** - zmienna ilościowa, wartościami są odpowiedzi na pytanie o zdrowie fizyczne pacjenta - przez ile dni w ciągu ostatnich 30 dni pacjent nie czuj się dobrze pod względem fizycznym (schorzenia i urazy) 

**DiffWalk** - zmienna jakościowa, przyjmuje wartości 0 lub 1, jeśli pacjent ma poważne problemy z chodzeniem lub wchodzeniem po schodach.

**Sex** - zmienna jakościowa określająca płeć pacjenta

**Age** - zmienna jakościowa określająca wiek pacjenta, przyjmuje wartości 1 do 13 (grupy wiekowe)

**Education** - zmienna jakościowa określająca poziom wykształcenia pacjenta, przyjmuje wartości całkowite od 1 do 6

**Income** - zmienna jakościowa opisująca zarobki pacjenta, przyjmuje wartości całkowite od 1 do 8 (przedziały zarobkowe)

```{r message=FALSE}
#| echo: false
#Załadowanie potrzebnych bibliotek

library(tidyverse)
library(caret)
library(rcompanion)
library(knitr)
library(kableExtra)
library(scales)
library(rstatix)
library(rpart)
library(rattle)
library(DT)
library(gt)
library(olsrr)
library(summarytools)
```

```{css, echo = FALSE}
.output {
max-height: 500px;
overflow-y: scroll;
}
```


```{r}
#| warning: false
#| echo: false
dane = read_csv('diabetes_split.csv')
dane <- dane %>%
mutate(CholCheck = factor(CholCheck),
HighBP = factor(HighBP),
HighChol = factor(HighChol),
Smoker = factor(Smoker),
Stroke = factor(Stroke),
HeartDiseaseorAttack = factor(HeartDiseaseorAttack),
PhysActivity = factor(PhysActivity),
Fruits = factor(Fruits),
Veggies = factor(Veggies),
HvyAlcoholConsump = factor(HvyAlcoholConsump),
AnyHealthcare = factor(AnyHealthcare),
NoDocbcCost = factor(NoDocbcCost),
DiffWalk = factor(DiffWalk),
Sex = factor(Sex),
Diabetes_binary = factor(Diabetes_binary),
Age = factor(Age),
Education = factor(Education),
Income = factor(Income),
GenHlth = factor(GenHlth))
```

```{r Podział zbioru na zmienne jakościowe i ilościowe, dodatkowo utworzenie podzbioru wyłącznie ze zmiennymi jakościowymi}
#| echo: false
numeric_vars <- c('BMI', 'MentHlth', 'PhysHlth')

num_vars_cols <- which(colnames(dane) %in% numeric_vars)

dane <- dane %>%
  mutate(across(!all_of(num_vars_cols), as.factor))

zmienne_jakosciowe <- dane[-num_vars_cols]
zmienne_ilosciowe <- dane[num_vars_cols]
```

## Przedstawienie liczebności obserwacji

```{r}
#| class: output
print(
  dfSummary(dane, 
            varnumbers   = FALSE,
            na.col       = FALSE,
            style        = "multiline",
            plain.ascii  = FALSE,
            valid.col = FALSE,
            headings     = FALSE,
            graph.magnif = .9,
            footnote = NA),
  method = "render"
)
```





```{r Liczebność oraz proporcje w grupach zmiennych jakościowych}
#| echo: false
freq_tab <- zmienne_jakosciowe %>% apply(2, freq_table)

for (i in seq_along(freq_tab)) {
  colnames(freq_tab[[i]])[1] <- names(freq_tab[i])
}
```

```{r}
#| echo: false
dark_theme <- function() {
  theme(panel.background = element_rect(fill = '#222222'),
        plot.background = element_rect(fill = '#222222'),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        axis.text = element_text(colour = 'white'),
        axis.title = element_text(colour = 'white'),
        legend.title = element_blank(),
        legend.background = element_rect(fill = 'gray'))
}
```

```{r}
#| echo: false
light_theme <- function() {
  theme(panel.background = element_rect(fill = 'white'),
        plot.background = element_rect(fill = 'white'),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_line(color = "black"),
        panel.grid.minor.y = element_line(color = "gray"),
        axis.text = element_text(colour = 'black'),
        axis.title = element_text(colour = 'black'),
        legend.title = element_blank(),
        legend.background = element_rect(fill = 'gray'))
}
```

### Podział na wiek

```{r Przykładowe wykresy obrazujące stosunek liczebności w podgrupach}
#| label: fig-wiek
#| fig-cap: Liczba respondentów zdrowych i diabetyków w grupach wiekowych
zmienne_jakosciowe %>%
  select(Diabetes_binary, Age) %>%
  group_by(Age, Diabetes_binary) %>%
  ggplot(aes(Age, fill = Diabetes_binary)) + 
  geom_bar(position = 'dodge') + 
  scale_fill_manual(values = c('0' = '#007FFF', 
                               '1' = 'red'),   
                    labels = c('Zdrowy', 'Diabetyk')) +
  scale_x_discrete(labels = c('1' = '18-24', 
                              '2' = '25-29',
                              '3' = '30-34', 
                              '4' = '35-39', 
                              '5' = '40-44', 
                              '6' = '45-49', 
                              '7' = '50-54', 
                              '8' = '55-59', 
                              '9' = '60-64', 
                              '10' = '65-69', 
                              '11' = '70-74', 
                              '12' = '75-79', 
                              '13' = '80+')) +
  scale_y_continuous(labels = label_number(scale = 1e-3,
                                           suffix = ' tys.'), 
                     breaks = seq(from = 0, to = 35000, 
                                  by = 1000)) +
  labs(x = 'Grupa wiekowa', y = 'Liczba respondentów') + 
  dark_theme() +
  theme(legend.position = c(0.15, 0.85),
        legend.key.size = unit(0.7, 'cm'))
```

Możemy zauważyć wzrost diabetyków wraz ze wzrostem wieku pacjenta. Dla grup 60-64 i wyżej są oni dominującą częścią.

### Podział na ciśnienie

::: panel-tabset
## Wykres słupkowy

```{r}
#| label: fig-diab
#| fig-cap: Liczba respondentów w podziale na ciśnienie krwi w normie lub z nadciśnieniem
zmienne_jakosciowe %>%
  select(Diabetes_binary, HighBP) %>%
  group_by(Diabetes_binary, HighBP) %>%
  ggplot(aes(Diabetes_binary, fill = HighBP)) + 
  geom_bar(position = 'dodge') +
  scale_fill_manual(values = c('0' = '#007FFF', '1' = 'red'), 
                    labels = c('Ciśnienie w normie',
                               'Nadciśnienie')) +
  scale_x_discrete(labels = c('0' = 'Zdrowy', 
                              '1' = 'Diabetyk')) +
  scale_y_continuous(labels = label_number(scale = 1e-3,
                                           suffix = ' tys.'), 
                     breaks = seq(from = 0, to = 125000, 
                                  by = 5000)) +
  labs(x = 'Czy respondent jest diabetykiem', 
       y = 'Liczba respondentów') +
  dark_theme()+
  theme(legend.position = c(0.5, 0.8),
        legend.key.size = unit(0.7, 'cm'))
  
```

## Histogram

```{r}
#| label: fig-ciswiek
#| fig-cap: Liczba respondentów w poszczególnych grupach wiekowych w zależności od ciśnienia krwi
zmienne_jakosciowe %>%
  select(Age, HighBP) %>%
  group_by(Age, HighBP) %>%
  ggplot(aes(Age, fill = HighBP)) + 
  geom_bar(position = 'dodge') +
  scale_fill_manual(values = c('0' = '#007FFF', '1' = 'red'), 
                    labels = c('Ciśnienie w normie',
                               'Nadciśnienie')) +
  scale_x_discrete(labels = c('1' = '18-24', 
                              '2' = '25-29', 
                              '3' = '30-34', 
                              '4' = '35-39', 
                              '5' = '40-44', 
                              '6' = '45-49', 
                              '7' = '50-54', 
                              '8' = '55-59', 
                              '9' = '60-64', 
                              '10' = '65-69', 
                              '11' = '70-74', 
                              '12' = '75-79', 
                              '13' = '80+')) +
  scale_y_continuous(labels = label_number(scale = 1e-3,
                                           suffix = ' tys.'), 
                     breaks = seq(from = 0, to = 20000, 
                                  by = 1000)) +
  labs(x = 'Grupa wiekowa', 
       y = 'Liczba respondentów') + 
  dark_theme() +
  theme(legend.position = c(0.2, 0.8),
        legend.key.size = unit(0.7, 'cm'))
```
:::

U diabetyków częściej stwierdzono nadciśnienie. Rośnie też ono wraz z wiekiem.

## Źródła

Dane pochodzą ze zbioru:

<https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset?select=diabetes_012_health_indicators_BRFSS2015.csv>
